# Scala Sandbox
Scala Play App for experimenting with the framework.
# Parse CSV
API tool to parse a CSV file from POST call
- Reply contains parsed data in JSON format (see `Reply Format`)
- Data is stored in a Postgres SQL Database

## Quickstart
With Docker:

1. `docker-compose up`, this will create:
    1. `scala-play-sandbox`
        1. `scala-play-sandbox_sbt_1` - main app
        1. `scala-play-sandbox_db_1` - postgres sql database

1. SBT will automatically run, starting the server. Expected output:
    ```
    --- (Running the application, auto-reloading is enabled) ---
    
    [info] p.c.s.AkkaHttpServer - Listening for HTTP on /0.0.0.0:9000
    ```
1. Access the server at `http://localhost:9000/`
1. clean up with `docker-compose down --volumes`

## Endpoints
### `GET: /checkDB`
Replies with success if the postgres database is connected and initialized.

###`POST: /parseCsv`
- header - `Content-Type: multipart/form-data`
- body - `upload=targetFileContent`

Uploaded file can have any name, but must be called `upload` in the POST body.

### Example Call
```
curl -F upload=@simpleTest.csv localhost:9000/parseCsv -H 'Content-Type: multipart/form-data'
```

### Accepted Input Formats

### Reply Format

## Unit Tests
`test/controllers/CsvControllSpec`
- Unit test coverage of all `CsvController.parseUtils` functions
    - API calls require mock data to a point where unit tests have limited value
- Tests cover data handling as described in `Accepted Input Formats`

##Postgres Database
Calls to parseCSV also write out to a postgres database.

### Database Setup
Setup to manually create a postgres database. `docker-compose` 
1. create a postgres SQL database
    1. Config values (any deviation requires modifying `application.conf` to match)
        ```scala
        db_name="postgres"
        db_user="postgres"
        db_password="postgres"
        db_port=5432
        ```
1. create schema and `importData` table
    ```sql
    CREATE SCHEMA IF NOT EXISTS scala_play_sandbox
   
   CREATE TABLE IF NOT EXISTS scala_play_sandbox.importdata (
      id serial primary key
      ,importName varchar(100) NOT NULL
      ,dateCreated timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP
    )
    ```
1. Run application and hit endpoint `checkDB`
    1. It queries the `importData` table. Proper DB configuration will return successfully.
    
### Schema Design

- Every import will create a new table with name matching the import name
    - Column names are header row values, limited to only alphanumeric characters
    - Columns are `VARCHAR(MAX)`
    - Insert are row by row (not batch inserted)
- Every import will add a record to `importdata` table, including the:
    - `id` - autogenerated PK
    - `importName` - unique name given to the import. This is also the table name.
    - `dateCreate` - timestamp of the import